# OPCO : TWF 시스템 기능 및 보안 프로세스 요약 보고서

오늘 진행된 주요 기능 업데이트와 보안성 강화 항목을 정리하여 보고드립니다.

## 1. 주요 기능 업데이트

### 👤 인사 데이터 동기화 (SQL Server ↔ Supabase)
- **개요**: 사내 SQL Server(`iopco`)의 재직자 정보를 Supabase 클라우드 데이터베이스로 동기화했습니다.
- **상세**: 퇴직자(`retyn = 'Y'`)를 제외한 총 129명의 실제 임직원 데이터가 시스템에 반영되어, 실시간 인사 정보에 기반한 인증이 가능해졌습니다.

### 🏠 전체 UI 동적 연동 (Total Dynamic UI)
- **개요**: 모든 페이지의 상단 헤더 및 통계 정보를 실제 로그인한 사용자 데이터와 연동했습니다.
- **변경 사항**: 하드코딩된 예시 이름("김진우" 등)을 제거하고, 로그인 세션의 메타데이터(`이름`, `부서`, `사번`, `역할`)를 실시간으로 반영합니다.
- **관리자 강조**: 관리자 로그인 시 역할 표시를 `[관리자]`와 같이 강조하여 권한 소유를 명확히 시각화했습니다.

---

## 2. 보안 프로세스 (Login & Security)

본 시스템의 로그인 프로세스는 보안성과 사용자 편의성을 동시에 고려하여 설계되었습니다.

### 🛡️ 하이브리드 인증 메커니즘
1. **사번 + 이름 검증**: 단순히 아이디만 입력하는 것이 아니라, 실제 인사 DB에 등록된 사번과 이름을 동시 검증합니다.
2. **Unicode 정규화**: 한글 성함 입력 시 발생할 수 있는 오타 또는 인코딩 문제를 방지하기 위해 NFC 정규화 로직을 도입했습니다.
3. **2차 관리자 인증 코드**: 관리자(`admin`) 권한으로 로그인 시, 사내에서 공유된 **공통 관리자 인증 코드(`OPCO_ADMIN_2024`)**를 추가로 입력해야만 로그인이 성립됩니다.

### 🌐 서버 사이드 로직 (Edge Functions)
- **보안 이점**: 사내 DB 조회 및 실제 로그인 세션 생성 로직은 클라이언트(브라우저)가 아닌 **Supabase Edge Function**에서 안전하게 실행됩니다.
- **자산 보호**: 데이터베이스 비밀번호나 서비스 롤 키가 브라우저에 노출되지 않으며, 서버 사이드에서만 안전하게 관리됩니다.

### 🔒 세션 및 권한 관리 (Row Level Security)
- **JWT 기반 세션**: 표준화된 JWT(JSON Web Token)를 사용하여 세션을 유지하며, 서버에서 유효성을 매번 검증합니다.
- **RLS 기반**: 향후 데이터베이스 레벨에서 본인이 작성한 제안서만 수정하거나, 심사위원만 점수를 입력할 수 있도록 하는 행 단위 보안 정책의 기반을 마련했습니다.

---

## 3. 사용자 안내 사항
- **UI 업데이트 확인**: 만약 상단 이름이 여전히 "김진우"로 보인다면, 이는 브라우저의 이전 버전 캐시일 확률이 매우 높습니다. 브라우저에서 **`Ctrl + F5`**를 눌러 강력 새로고침을 진행해 주시기 바랍니다.
- **관리자 로그인**: 관리자로 로그인 시 헤더의 역할 부분이 **`[관리자]`** (강조색)로 표시되는 것을 확인하실 수 있습니다.
